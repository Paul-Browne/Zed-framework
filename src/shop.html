<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <link rel="apple-touch-icon" sizes="180x180" href="apple-touch-icon.png" />
    <link rel="icon" type="image/png" sizes="32x32" href="favicon-32x32.png" />
    <link rel="icon" type="image/png" sizes="16x16" href="favicon-16x16.png" />
    <link rel="manifest" href="site.webmanifest" />
    <link rel="mask-icon" href="safari-pinned-tab.svg" color="#1d92d6" />
    <meta name="apple-mobile-web-app-title" content="Zed.js" />
    <meta name="application-name" content="Zed.js" />
    <meta name="msapplication-TileColor" content="#1d92d6" />
    <meta name="theme-color" content="#ffffff" />
    <meta
      name="google-site-verification"
      content="JiN9sTM6v_GuVjlwx5up078oFwAyh7A-q8r28slL93g"
    />
    <meta
      name="description"
      content="Zed.js is a templateless micro frontend framework. It handles the rendering, updating and state management of your html components in only 854 bytes"
    />
    <script>
      !(function(e) {
        if (!e.Z) {
          var d = {};
          e.Z = {
            load: function(e, r) {
              var o = [];
              e.forEach(function(e, t) {
                o[t] = null;
                var n = new XMLHttpRequest();
                for (var a in ((n.onreadystatechange = function() {
                  4 == n.readyState &&
                    ((o[t] =
                      n.status == (e.status || 200)
                        ? e.callback
                          ? e.callback(n.responseText)
                          : n.responseText
                        : void 0),
                    (Z.load[e.id] = o[t]),
                    ~o.indexOf(null) || r(o));
                }),
                n.open(e.method || "GET", e.url, !0),
                e.headers))
                  n.setRequestHeader(a, e.headers[a]);
                n.send(e.body);
              });
            },
            update: function(e, t) {
              d[e] &&
                (d[e].f(t),
                d[e].l.forEach(function(e) {
                  e();
                }));
            },
            mount: function(n, e) {
              n.id &&
                !e &&
                (d[n.id] = {
                  l: [],
                  f: function(e) {
                    for (var t in e) n[t] = e[t];
                    Z.mount(n, !0);
                  }
                });
              var t = n.inner,
                a = n.outer,
                r = n.state,
                o = n.before,
                i = n.after,
                u = { state: r, prev: Z[n.id] };
              if (0 != (o && o(u.state, u.prev))) {
                var s = n.render(u.state, u.prev);
                t && (t.innerHTML = s),
                  a && (a.outerHTML = s),
                  i && i(u.state, u.prev);
              }
              Z[n.id] = r;
            },
            watch: function(e, t) {
              d[e] && d[e].l.push(t);
            }
          };
        }
      })(window);
    </script>

    <title>Zed.js • Shop</title>
    <style type="text/css">
      *,
      *:before,
      *:after {
        box-sizing: border-box;
      }

      body {
        font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto,
          Helvetica, Arial, sans-serif, "Apple Color Emoji", "Segoe UI Emoji",
          "Segoe UI Symbol";
      }

      #products {
        display: flex;
        justify-content: space-around;
        flex-wrap: wrap;
        max-width: 1200px;
        margin: 0 auto;
      }

      #products .product {
        width: 230px;
        display: flex;
        flex-direction: column;
        align-items: center;
        justify-content: flex-end;
        border: 1px solid #ddd;
        padding: 1rem;
        border-radius: 6px;
        margin-bottom: 1em;
        cursor: pointer;
      }

      #products .product h2 {
        margin-top: 0;
        margin-bottom: auto;
      }

      #products .product img {
        vertical-align: middle;
        margin: 1em 0;
      }

      .view-modal:before {
        content: "";
        position: fixed;
        top: 0;
        left: 0;
        height: 100%;
        width: 100%;
        background: rgba(0, 0, 0, 0.4);
      }

      .view {
        background: #fff;
        border-radius: 6px;
        padding: 1em 2em;
        position: fixed;
        top: 50%;
        left: 50%;
        transform: translate(-50%, -50%);
        max-height: 100%;
        max-width: 100%;
        overflow: auto;
        box-sizing: border-box;
      }
    </style>
  </head>
  <body>
    <div id="basket"></div>
    <div id="products"></div>
    <div id="view"></div>
    <script>
      Z.mount({
        id: "basket",
        render: function(state) {
          var total = state.products.reduce(function(acc, current) {
            return acc + current.quantity * current.price;
          }, 0);
          return (
            state.products
              .map(function(product, index) {
                return `
                <div>
                  <span>${
                    product.name
                  }</span> <span><button onclick="Z.basket.adjustCart(${index}, -1)">-</button> <span>${product.quantity}</span> <button onclick="Z.basket.adjustCart(${index}, 1)">+</button></span> <span>${(product.price * product.quantity).toFixed(2)}</span>
                </div>`;
              })
              .join("") + `<div><span>Total: ${total.toFixed(2)}</span></div>`
          );
        },
        inner: document.getElementById("basket"),
        state: {
          products: JSON.parse(localStorage.getItem("basket")) || [],
          update: function() {
            localStorage.setItem("basket", JSON.stringify(this.products));
            Z.update("basket", {
              state: this
            });
            Z.update("button");
          },
          adjustCart: function(index, increment) {
            Z.basket.products[index].quantity += increment;
            if (!Z.basket.products[index].quantity) {
              Z.basket.products.splice(index, 1);
            }
            Z.basket.update();
          },

          addToBasket: function(item) {
            var basketObj = {
              name: item.name,
              price: item.price
            };

            var cartContainsItem = Z.basket.products.some(function(
              product,
              index
            ) {
              if (product.name === basketObj.name) {
                product.quantity = product.quantity + 1;
                return true;
              }
            });

            if (!cartContainsItem) {
              basketObj.quantity = 1;
              Z.basket.products.push(basketObj);
            }
            Z.basket.update();
          }
        }
      });

      Z.mount({
        id: "view",
        render: function(state) {
          var btn = `<button onclick="Z.basket.addToBasket(Z.view)">Add To Cart</button>`;
          Z.basket.products.forEach(function(product, index) {
            if (product.name === state.name) {
              btn = `<button onclick="Z.basket.adjustCart(${index}, -1)">-</button> <span>${product.quantity}</span> <button onclick="Z.basket.adjustCart(${index}, 1)">+</button>`;
            }
          });
          return state.name
            ? `
            <div class="view-modal">
              <div class="view">
                  <button onclick='Z.update("view", {state:{}})'>close</button>
                  <h3>${state.name}</h3>
                  <img src="images/${state.image}" width="250">
                  <p>${state.price} €</p>
                  <div id="button"></div>
              </div>
            </div>
            `
            : "";
        },
        after: function(viewState) {
          Z.mount({
            id: "button",
            render: function() {
              var btn = `<button onclick="Z.basket.addToBasket(Z.view)">Add To Cart</button>`;
              Z.basket.products.forEach(function(product, index) {
                if (product.name === viewState.name) {
                  btn = `<button onclick="Z.basket.adjustCart(${index}, -1)">-</button> <span>${product.quantity}</span> <button onclick="Z.basket.adjustCart(${index}, 1)">+</button>`;
                }
              });
              return btn;
            },
            inner: document.getElementById("button")
          });
        },
        inner: document.getElementById("view"),
        state: {}
      });

      Z.load(
        [
          {
            id: "products",
            url: "json/products.json",
            callback: function(data) {
              return JSON.parse(data);
            }
          }
        ],
        function() {
          Z.mount({
            id: "products",
            render: function(state) {
              return state
                .map(function(product, index) {
                  return `
                  <div class="product" onclick='Z.update("view", {state:Z.products[${index}]})'>
                    <h2>${product.name}</h2>
                    <img src="images/${product.image}" width="200">
                    <span>${product.price} €</span>
                  </div>`;
                })
                .join("");
            },
            inner: document.getElementById("products"),
            state: Z.load.products
          });
        }
      );
    </script>
    <script
      async
      src="https://www.googletagmanager.com/gtag/js?id=UA-36765884-7"
    ></script>
    <script>
      window.dataLayer = window.dataLayer || [];
      function gtag() {
        dataLayer.push(arguments);
      }
      gtag("js", new Date());
      gtag("config", "UA-36765884-7");
    </script>
  </body>
</html>
